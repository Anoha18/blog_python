{% extends 'main/layouts/layout.html' %}

{% block links %}
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.css">
{% endblock %}

{% block title %}{{ post.title|default:'Пост' }}{% endblock %}
{% block content %}
<main style="overflow-y: auto; height: 100%;">
  {% include 'main/components/header.html' %}
  <div class="container pt-3">
    <div class="row">
      <div class="col-12">
        <img src="{{ post.image }}" class="img-fluid post-image rounded" alt="image">
        <h1 class="mt-3">{{ post.title }}</h1>
        <div class="post-body">
          {{ post.body|safe }}
        </div>
        <hr>
        <div class="d-flex flex-row align-items-center justify-content-between">
          <div class="account-post-card-meta d-flex flex-row">
            <div class="card-meta__item" style="margin-right: 10px;">
              <i class="fas fa-eye"></i>
              <span>{{ post.views_count|default_if_none:0 }}</span>
            </div>
            <div class="card-meta__item">
              <i class="fas fa-comment-alt"></i>
              <span>{{ post.comments_count|default_if_none:0 }}</span>
            </div>
          </div>
        </div>
        <hr>
        <h2>Комментарии {{ post.comments_count|default_if_none:0 }}</h2>
        <hr>
        {% if post.comments|length %}
          <div class="post-comments mb-3">
            {% for comment in post.comments %}
              {% if comment.parent_id is None %}
                {% include 'main/components/comment.html' %}
              {% endif %}
            {% endfor %}
          </div>
        {% endif %}
        {% if request.user.id %}
          {% include 'main/components/comment_form.html' %}
        {% else %}
        <div class="mb-3">
          Только авторизированные пользователи могут оставлять комментарии. <a href="{% url 'login' %}">Войдите</a>, пожалуйста.
        </div>
        {% endif %}
      </div>
    </div>
  </div>
  {% include 'main/components/footer.html' %}
</main>
{% endblock %}

{% block scripts %}
  {% load static %}
  <script src="https://cdn.jsdelivr.net/simplemde/latest/simplemde.min.js"></script>
  <script src="{% static 'main/js/post.js' %}"></script>
{% endblock %}